<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Outbreak Epidemiology Disease Simulator</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
<header>
  <div class="wrap header-bar">
    <div class="header-text">
      <h1>Outbreak Epidemiology Disease Simulator</h1>
      <div class="sub">
        Simulation of disease outbreaks using a toy SEIRD-style model with vaccination and waning immunity.
        Parameter sets are illustrative, not calibrated for policy decisions. Use as a learning sandbox to
        explore how changing transmission, duration, mortality, and vaccination assumptions alters dynamics.
      </div>
    </div>

    <div class="header-controls">
      <select id="themeSelect" aria-label="Select theme">
        <option value="light">Light</option>
        <option value="dark">Dark</option>
        <option value="accessible">Accessible</option>
      </select>
    </div>
  </div>
</header>

<main class="wrap grid" aria-live="polite">
  <section class="panel pad">
    <div class="divider-label timelineTitle">Startup Parameters</div>
    <div class="row" id="coreRow">
      <div class="cell">
        <label>Preset Scenario:</label>
        <select id="scenario">
          <option value="custom">Custom</option>
          <option value="rare">Rare Disease</option>
          <option value="endemic">Endemic Stability</option>
          <option value="outbreak">Acute Outbreak</option>
          <option value="flu">Flu-like</option>
          <option value="covid">COVID-like</option>
          <option value="measles">Measles-like</option>
          <option value="ebola">Ebola-like</option>
          <option value="sars1">SARS-1-like</option>
          <option value="mers">MERS-like</option>
          <option value="noro">Norovirus-like</option>
        </select>
      </div>

      <div class="cell">
        <label>Population N (<span id="NVal">5000</span>):</label>
        <input
          id="N"
          class="popSlider"
          type="range"
          min="2"
          max="10000"
          step="1"
          value="5000"
        />
      </div>

      <div class="cell w2">
        <label>Daily Contacts (4 or 6):</label>
        <select id="contacts">
          <option value="4" selected>4 · Square grid</option>
          <option value="6">6 · Hex grid</option>
        </select>
      </div>

      <div class="cell w2">
        <label>Seed:</label>
        <input id="seed" type="number" value="42" />
      </div>

      <div class="cell w2">
        <label>Stochastic For Infection:</label>
        <select id="stochastic">
          <option value="1">On</option>
          <option value="0">Off</option>
        </select>
      </div>

      <div class="cell w2">
        <label>Initial Infected:</label>
        <input id="I0" type="number" min="0" max="10000" step="1" value="5" />
      </div>

      <div class="cell w2">
        <label>Initial Immune:</label>
        <input id="R0" type="number" min="0" max="10000" step="1" value="0" />
      </div>

      <div class="cell w2">
        <label>
          Mutation / waning (immune → susceptible / day):
          <span class="hint" id="mutRateVal">0.000</span>
        </label>
        <input id="mutRate" type="range" min="0" max="0.5" step="0.0005" value="0" />
      </div>

      <div class="cell w2">
        <label>
          Days Infectious (affects recovery rate): 
          <span class="hint" id="daysInfVal">10.0</span>
        </label>
        <input id="daysInf" type="range" min="1" max="30" step="0.5" value="10" />
      </div>

      <div class="cell w2">
        <label>Time step (days):</label>
        <input id="dt" type="number" min="0.1" max="10" step="0.1" value="1" />
      </div>

      <div class="cell w2">
        <label>Auto-stop when stable:</label>
        <select id="autoStop">
          <option value="1">On</option>
          <option value="0">Off</option>
        </select>
      </div>
    </div>

    <div class="simLayout">
      <div class="panel pad">
        <div class="row">
          <div class="cell w12">
            <div class="divider-label timelineTitle">Live parameters</div>
          </div>

          <div class="cell w4">
            <label>Infection rate β <span class="hint" id="betaVal"></span></label>
            <input id="beta" type="range" min="0" max="1.2" step="0.001" value="0.35" />
          </div>
          <div class="cell w4">
            <label>Recovery rate γ <span class="hint" id="gammaVal"></span></label>
            <input id="gamma" type="range" min="0" max="1" step="0.001" value="0.1" />
          </div>
          <div class="cell w4">
            <label>Mortality rate μ <span class="hint" id="muVal"></span></label>
            <input id="mu" type="range" min="0" max="0.5" step="0.0001" value="0.01" />
          </div>

          <div class="cell w4">
            <label>Vaccine / Medication Efficacy (%) <span class="hint" id="veVal"></span></label>
            <input id="ve" type="range" min="0" max="100" step="1" value="100" />
          </div>
          <div class="cell w4">
            <label>Vaccination Coverage (%) <span class="hint" id="vaxCovVal">0%</span></label>
            <input id="vaxCov" type="range" min="0" max="100" step="1" value="0" />
          </div>
          <div class="cell w4">
            <label>Daily Vaccination Rate (%-points/day) <span class="hint" id="vaxRateVal">0.0 pts/day</span></label>
            <input id="vaxRate" type="range" min="0" max="5" step="0.001" value="0" />
          </div>

          <div class="cell w6">
            <span class="hint">
              R₀ (theoretical)=<span id="R0disp">–</span>
            </span>
            <span class="hint">
              · R<sub>t</sub> (approx)=<span id="RtDisp">–</span>
            </span>
          </div>

          <div class="cell w12">
            <div class="timePanel">
              <div class="timelineTitle">Timeline</div>
              <div class="scrubWrap">
                <button class="btn" id="toggleBtn" aria-pressed="false">▶ Run</button>
                <button class="btn ghost" id="resetBtn">Reset</button>
                <span class="hint">t=<span id="timeDisp">0</span> days</span>
                <div class="hint">Viewing: <span id="viewLabel">Live</span></div>
              </div>
              <div class="scrubWrap">
                <span class="hint" id="scrubMin">0</span>
                <input type="range" id="scrubber" min="0" max="0" value="0" />
                <span class="hint" id="scrubVal">0</span>
                <span class="hint">/</span>
                <span class="hint" id="scrubMax">0</span>
                <span class="hint">days</span>
              </div>

              <div class="scrubWrap">
                <span class="hint">Duplicate this configuration in a new window: </span>
                <button class="btn ghost" id="cloneTimelineBtn" type="button">
                  Clone parameters
                </button>
              </div>
            </div>
          </div>

        </div>
      </div>

      <div class="sim">
        <div class="canvasWrap panel pad">
          <canvas id="sim" width="900" height="520" aria-label="Population grid"></canvas>
        </div>
        <aside class="sidebar panel">
          <div class="status">
            <div class="barsWrap">
              <div class="bar" aria-label="Status bar">
                <div class="seg" id="seg-imm"  style="background:var(--c-imm);height:0%"></div>
                <div class="seg" id="seg-exp"  style="background:var(--c-exp);height:0%"></div>
                <div class="seg" id="seg-inf"  style="background:var(--c-inf);height:0%"></div>
                <div class="seg" id="seg-sus"  style="background:var(--c-sus);height:100%"></div>
                <div class="seg" id="seg-dead" style="background:var(--c-dead);height:0%"></div>
              </div>

              <div class="legend">
                <div class="dot" style="background:var(--c-sus)"></div>
                <div>Susceptible <span id="pctS">100%</span> <span id="cntS" class="cnt">(0)</span></div>

                <div class="dot" style="background:var(--c-exp)"></div>
                <div>Exposed <span id="pctE">0%</span> <span id="cntE" class="cnt">(0)</span></div>

                <div class="dot" style="background:var(--c-inf)"></div>
                <div>Infectious <span id="pctI">0%</span> <span id="cntI" class="cnt">(0)</span></div>

                <div class="dot" style="background:var(--c-imm)"></div>
                <div>Immune <span id="pctR">0%</span> <span id="cntR" class="cnt">(0)</span></div>

                <div class="dot" style="background:var(--c-dead)"></div>
                <div>Dead <span id="pctD">0%</span> <span id="cntD" class="cnt">(0)</span></div>

                <div class="vaxLegendIcon"></div>
                <div>
                  Vaccinated &amp; protected
                  <span id="pctVeff">0%</span>
                  <span id="cntVeff" class="cnt">(0)</span>
                </div>

                <div class="vaxLegendIcon dotted"></div>
                <div>
                  Vaccinated, not effectively protected
                  <span id="pctVineff">0%</span>
                  <span id="cntVineff" class="cnt">(0)</span>
                </div>
              </div>
            </div>
          </div>
        </aside>
      </div>
    </div>

    <div class="panel pad chartsPanel">
      <div class="chartsRow">
        <div class="chartCell">
          <div class="chartTitle">Incidence, Prevalence &amp; % Vaccinated</div>
          <p class="chartExplain">
            <span style="color:var(--c-exp)">Incidence</span>: new infections per time step (S→E).
            <span style="color:var(--accent2)">Prevalence</span>: infectious individuals at each time.
            <span style="color:var(--accent)">Blue line</span>: percent of the population ever vaccinated.
          </p>
          <canvas
            id="incVaxChart"
            class="chartCanvas"
            aria-label="Incidence, prevalence, and percent vaccinated over time">
          </canvas>
        </div>
        <div class="chartCell">
          <div class="chartTitle">SEIRD Compartments</div>
          <p class="chartExplain">
            Tracks
            <span style="color:var(--c-sus)">susceptible</span>,
            <span style="color:var(--c-exp)">exposed</span>,
            <span style="color:var(--c-inf)">infectious</span>,
            <span style="color:var(--c-imm)">immune/recovered</span>,
            and <span style="color:var(--c-dead)">dead</span> over time.
          </p>
          <canvas
            id="sirChart"
            class="chartCanvas"
            aria-label="Susceptible, Exposed, Infectious, Immune, Dead over time">
          </canvas>
        </div>
      </div>
    </div>

    <div class="panel pad metricsPanel">
      <div class="metricsTitle">Epidemiologic Summary at Viewed Time</div>
      <div class="metricsSub">
        Uses tracked incident infections (S→E) for cumulative incidence, incidence rate, and CFR.
      </div>

      <div class="metricsGrid">
        <div class="metricsBlock">
          <div class="metricsBlockTitle">Context</div>
          <table class="metricsTable">
            <tbody>
              <tr>
                <th>Time (t)</th>
                <td id="m-t" class="val"></td>
                <td class="formula">Days since start</td>
              </tr>
              <tr>
                <th>Total population (N)</th>
                <td id="m-N" class="val"></td>
                <td class="formula">Initial individuals</td>
              </tr>
              <tr>
                <th>Alive at t</th>
                <td id="m-alive" class="val"></td>
                <td class="formula">N − deaths(t)</td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="metricsBlock">
          <div class="metricsBlockTitle">
            <span class="tag tag-inc">
              Incidence &amp; Risk
            </span>
          </div>
          <table class="metricsTable">
            <tbody>
              <tr class="metricRow-inc">
                <th>
                  Cumulative incidence (risk)
                </th>
                <td id="m-cumInc" class="val"></td>
                <td class="formula">
                  Incident infections(0→t)
                  /
                  at-risk at start (N − I₀ − immune₀)
                </td>
              </tr>

              <tr class="metricRow-inc">
                <th>Incidence risk</th>
                <td id="m-incRisk" class="val"></td>
                <td class="formula">
                  Same as cumulative incidence over [0, t]
                </td>
              </tr>

              <tr class="metricRow-inc">
                <th>Average risk per day</th>
                <td id="m-riskRate" class="val"></td>
                <td class="formula">
                  Cumulative incidence / time interval
                </td>
              </tr>

              <tr class="metricRow-inc">
                <th>Incidence rate</th>
                <td id="m-incRate" class="val"></td>
                <td class="formula">
                  Incident infections(0→t)
                  /
                  person-time at risk
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="metricsBlock">
          <div class="metricsBlockTitle">
            <span class="tag tag-prev">
              Prevalence &amp; Severity
            </span>
          </div>
          <table class="metricsTable">
            <tbody>
              <tr class="metricRow-prev">
                <th>
                  Point prevalence (infectious)
                </th>
                <td id="m-prevPoint" class="val"></td>
                <td class="formula">
                  Infectious(t) / alive(t)
                </td>
              </tr>

              <tr>
                <th>
                  Ever infected (unique, simulated)
                </th>
                <td id="m-everInf" class="val color-inc"></td>
                <td class="formula">
                  Individuals with ≥1 S→E since start
                </td>
              </tr>

              <tr class="metricRow-severe">
                <th>
                  Case fatality risk
                </th>
                <td id="m-cfr" class="val color-dead"></td>
                <td class="formula">
                  Deaths(t) / ever infected (incident)
                </td>
              </tr>
            </tbody>
          </table>
        </div>

      </div>
    </div>

    <div class="panel pad" style="margin-top:12px">
      <button class="btn ghost" id="exportCSV">Export Time Series (CSV)</button>
    </div>
  </section>
</main>

<div class="footer">
  © <span id="year"></span> TapTiger Dev · MIT License · For teaching use only
</div>

<script src="sim-app.js"></script>
</body>
</html>
